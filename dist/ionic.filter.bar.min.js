angular.module("jett.ionic.filter.bar",["ionic"]),function(e,t){"use strict";e.module("jett.ionic.filter.bar").directive("ionFilterBar",["$timeout","$ionicGesture","$ionicPlatform",function(o,r,n){var i;return i=n.is("android")?'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><button class="filter-bar-cancel button button-icon icon {{::config.back}}"></button><label class="item-input-wrapper"><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}" /><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label></div></div>':'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><label class="item-input-wrapper"><i class="icon {{::config.search}} placeholder-icon"></i><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}"/><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label><button class="filter-bar-cancel button button-clear" ng-bind-html="::cancelText"></button></div></div>',{restrict:"E",scope:!0,link:function(n,i){var a,l,c,s,d,f=i[0],u=f.querySelector(".filter-bar-clear"),m=f.querySelector(".filter-bar-cancel"),p=f.querySelector(".filter-bar-search"),h=function(){n.cancelFilterBar()};n.config.backdrop&&(c=e.element('<div class="filter-bar-backdrop"></div>'),i.append(c),s=function(e){e.target==c[0]&&h()},c.bind("click",s),l=r.on("swipe",s,c)),n.favoritesEnabled?n.getClearButtonClass=function(){return n.data.filterText.length?n.config.clear:n.config.favorite}:n.getClearButtonClass=function(){return n.data.filterText.length?n.config.clear:"filter-bar-element-hide"};var b=function(){u.classList.contains(n.config.favorite)?n.showModal():o(function(){n.data.filterText="",ionic.requestAnimationFrame(function(){n.showBackdrop(),n.scrollItemsTop(),n.focusInput()})})},g=function(){n.scrollItemsTop(),n.focusInput()},v=function(e){27==e.which?h():n.data.filterText&&n.data.filterText.length?n.hideBackdrop():n.showBackdrop()};m.addEventListener("click",h),u.addEventListener("touchstart",b),u.addEventListener("mousedown",b),p.addEventListener("touchstart",g),p.addEventListener("mousedown",g),t.addEventListener("keyup",v);var $=function(){n.filterItems(n.data.filterText)};n.$on("$destroy",function(){i.remove(),t.removeEventListener("keyup",v),c&&r.off(l,"swipe",s),d()}),d=n.$watch("data.filterText",function(e,t){var r;a&&o.cancel(a),e!==t&&(r=e.length&&n.debounce?n.delay:0,a=o($,r,!1))})},template:i}}])}(angular,document),function(e){"use strict";e.module("jett.ionic.filter.bar").provider("$ionicFilterBarConfig",function(){function t(e,t){l.platform[e]=t,i.platform[e]={},o(l,l.platform[e]),r(l.platform[e],i.platform[e],"")}function o(t,r){for(var n in t)n!=a&&t.hasOwnProperty(n)&&(e.isObject(t[n])?(e.isDefined(r[n])||(r[n]={}),o(t[n],r[n])):e.isDefined(r[n])||(r[n]=null))}function r(t,o,i){e.forEach(t,function(c,s){e.isObject(t[s])?(o[s]={},r(t[s],o[s],i+"."+s)):o[s]=function(e){if(arguments.length)return t[s]=e,o;if(t[s]==a){var r=n(l.platform,ionic.Platform.platform()+i+"."+s);return r||r===!1?r:n(l.platform,"default"+i+"."+s)}return t[s]}})}function n(t,o){o=o.split(".");for(var r=0;r<o.length;r++){if(!t||!e.isDefined(t[o[r]]))return null;t=t[o[r]]}return t}var i=this;i.platform={};var a="platform",l={theme:a,clear:a,add:a,close:a,done:a,remove:a,reorder:a,favorite:a,search:a,backdrop:a,transition:a,platform:{},placeholder:a};r(l,i,""),t("default",{clear:"ion-ios-close",add:"ion-ios-plus-outline",close:"ion-ios-close-empty",done:"ion-ios-checkmark-empty",remove:"ion-ios-trash-outline",reorder:"ion-drag",favorite:"ion-ios-star",search:"ion-ios-search-strong",backdrop:!0,transition:"vertical",placeholder:"Search"}),t("ios",{}),t("android",{clear:"ion-android-close",close:"ion-android-close",done:"ion-android-done",remove:"ion-android-delete",favorite:"ion-android-star",search:!1,backdrop:!1,transition:"horizontal"}),i.setPlatformConfig=t,i.$get=function(){return i}})}(angular),function(e,t){"use strict";var o='<ion-modal-view ng-controller="$ionicFilterBarModalCtrl" class="filter-bar-modal"><ion-header-bar class="bar bar-{{::config.theme}} disable-user-behavior"><button class="button button-icon {{::config.close}}" ng-click="closeModal()"></button><h1 class="title" ng-bind-html="::favoritesTitle"></h1><button ng-if="searches.length > 1" class="button button-icon" ng-class="displayData.showReorder ? config.done : config.reorder" ng-click="displayData.showReorder = !displayData.showReorder"></button></ion-header-bar><ion-content><ion-list show-reorder="displayData.showReorder" delegate-handle="searches-list"><ion-item ng-repeat="item in searches" class="item-remove-animate" ng-class="{reordered: item.reordered}" ng-click="itemClicked(item.text, $event)"><span ng-bind-html="item.text"></span><ion-option-button class="button-assertive icon {{::config.remove}}" ng-click="deleteItem(item)"></ion-option-button><ion-reorder-button class="{{::config.reorder}}" on-reorder="moveItem(item, $fromIndex, $toIndex)"></ion-reorder-button></ion-item><div class="item item-input"><input type="text" ng-model="newItem.text" placeholder="{{::favoritesAddPlaceholder}}"/><button class="button button-icon icon {{::config.add}}" ng-click="addItem(newItem)"></button></div></ion-list></ion-content> </ion-modal-view>',r=function(e){var t=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],o=e&&e.classList;if(o)for(var r=0;r<t.length;r++)if(o.contains("bar-"+t[r]))return t[r]};e.module("jett.ionic.filter.bar").factory("$ionicFilterBar",["$document","$rootScope","$compile","$timeout","$filter","$q","$ionicPlatform","$ionicFilterBarConfig","$ionicConfig","$ionicModal","$ionicScrollDelegate",function(n,i,a,l,c,s,d,f,u,m,p){function h(n){if(!b){b=!0,n=n||{};var f=i.$new(!0),u=!1,h=!1;n.container&&(n.container=g.querySelector(n.container)),e.extend(f,{config:v,$deregisterBackButton:e.noop,update:e.noop,cancel:e.noop,done:e.noop,scrollDelegate:p,filter:c("filter"),filterProperties:null,expression:null,comparator:null,debounce:!0,delay:300,cancelText:"Cancel",cancelOnStateChange:!0,container:g,search:null,favoritesTitle:"Favorite Searches",favoritesAddPlaceholder:"Add a search term",favoritesEnabled:!1,favoritesKey:"ionic_filter_bar_favorites"},n),f.data={filterText:""},f.config.theme||(f.config.theme=r(f.container.querySelector(".bar.bar-header")));var $=f.element=a('<ion-filter-bar class="filter-bar"></ion-filter-bar>')(f),w=$.children().eq(0),B=w.find("input")[0],k=$.children().eq(1),y=f.scrollDelegate.getScrollView(),x=!!y,I=x?y.__container:null,T=f.cancelOnStateChange?i.$on("$stateChangeSuccess",function(){f.cancelFilterBar()}):e.noop,C=function(){h||(h=!0,B&&B.focus())},F=function(){h&&(h=!1,B&&B.blur())},S=function(){y.__scrollTop>0&&F()};return f.scrollItemsTop=function(){x&&y.__scrollTop>0&&f.scrollDelegate.scrollTop&&f.scrollDelegate.scrollTop()},f.focusInput=function(){h=!1,C()},f.hideBackdrop=function(){k.length&&u&&(u=!1,k.removeClass("active").css("display","none"))},f.showBackdrop=function(){k.length&&!u&&(u=!0,k.css("display","block").addClass("active"))},f.showModal=function(){f.modal=m.fromTemplate(o,{scope:f}),f.modal.show()},f.filterItems=function(t){var o,r;t.length?e.isFunction(f.search)?r=f.search(t):(f.expression?o=e.bind(this,f.expression,t):e.isArray(f.filterProperties)?(o={},e.forEach(f.filterProperties,function(e){o[e]=t})):f.filterProperties?(o={},o[f.filterProperties]=t):o=t,r=f.filter(f.items,o,f.comparator)):r=f.items,s.when(r).then(function(e){l(function(){f.update(e,t),f.scrollItemsTop()})})},f.$deregisterBackButton=d.registerBackButtonAction(function(){l(f.cancelFilterBar)},300),f.removeFilterBar=function(o){f.removed||(f.removed=!0,t.requestAnimationFrame(function(){w.removeClass("filter-bar-in"),F(),f.hideBackdrop(),l(function(){f.scrollItemsTop(),f.update(f.items),f.$destroy(),$.remove(),f.cancelFilterBar.$scope=f.modal=I=y=w=k=B=null,b=!1,(o||e.noop)()},350)}),l(function(){f.container.classList.remove("filter-bar-open")},400),f.$deregisterBackButton(),T(),I&&I.removeEventListener("scroll",S))},f.showFilterBar=function(o){f.removed||(f.container.appendChild($[0]),f.container.classList.add("filter-bar-open"),f.scrollItemsTop(),t.requestAnimationFrame(function(){f.removed||l(function(){w.addClass("filter-bar-in"),f.focusInput(),f.showBackdrop(),(o||e.noop)()},20,!1)}),I&&I.addEventListener("scroll",S))},f.cancelFilterBar=function(){f.removeFilterBar(f.cancel)},f.showFilterBar(f.done),f.cancelFilterBar.$scope=f,f.cancelFilterBar}}var b=!1,g=n[0].body,v={theme:f.theme(),transition:f.transition(),back:u.backButton.icon(),clear:f.clear(),favorite:f.favorite(),search:f.search(),backdrop:f.backdrop(),placeholder:f.placeholder(),close:f.close(),done:f.done(),reorder:f.reorder(),remove:f.remove(),add:f.add()};return{show:h}}])}(angular,ionic),function(e){"use strict";e.module("jett.ionic.filter.bar").controller("$ionicFilterBarModalCtrl",["$window","$scope","$timeout","$ionicListDelegate",function(t,o,r,n){var i=o.$parent.favoritesKey;o.displayData={showReorder:!1},o.searches=e.fromJson(t.localStorage.getItem(i))||[],o.newItem={text:""},o.moveItem=function(e,t,n){e.reordered=!0,o.searches.splice(t,1),o.searches.splice(n,0,e),r(function(){delete e.reordered},500)},o.deleteItem=function(e){var t=o.searches.indexOf(e);o.searches.splice(t,1)},o.addItem=function(){o.newItem.text&&(o.searches.push({text:o.newItem.text}),o.newItem.text="")},o.closeModal=function(){t.localStorage.setItem(i,e.toJson(o.searches)),o.$parent.modal.remove()},o.itemClicked=function(e,t){var r=!!t.currentTarget.querySelector(".item-options.invisible");r?(o.closeModal(),o.$parent.hideBackdrop(),o.$parent.data.filterText=e,o.$parent.filterItems(e)):n.$getByHandle("searches-list").closeOptionButtons()}}])}(angular);