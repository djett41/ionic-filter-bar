angular.module("jett.ionic.filter.bar",["ionic"]),function(e,t){"use strict";e.module("jett.ionic.filter.bar").directive("ionFilterBar",["$timeout","$ionicGesture","$ionicPlatform",function(o,r,n){var i;return i=n.is("android")?'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><button class="filter-bar-cancel button button-icon icon {{::config.back}}"></button><label class="item-input-wrapper"><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}" /><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label></div></div>':'<div class="filter-bar-wrapper filter-bar-{{::config.theme}} filter-bar-transition-{{::config.transition}}"><div class="bar bar-header bar-{{::config.theme}} item-input-inset"><label class="item-input-wrapper"><i class="icon {{::config.search}} placeholder-icon"></i><input type="search" class="filter-bar-search" ng-model="data.filterText" placeholder="{{::config.placeholder}}"/><button class="filter-bar-clear button button-icon icon" ng-class="getClearButtonClass()"></button></label><button class="filter-bar-cancel button button-clear" ng-bind-html="::cancelText"></button></div></div>',{restrict:"E",scope:!0,link:function(n,i){var a,c,l,s,d,f=i[0],u=f.querySelector(".filter-bar-clear"),p=f.querySelector(".filter-bar-cancel"),m=f.querySelector(".filter-bar-search"),h=function(){n.cancelFilterBar()};n.config.backdrop&&(l=e.element('<div class="filter-bar-backdrop"></div>'),i.append(l),s=function(t){t.target==l[0]&&(n.backdropClick!==e.noop?n.backdropClick(n.data.filterItems,n.data.filterText):h())},l.bind("click",s),c=r.on("swipe",s,l)),n.favoritesEnabled?n.getClearButtonClass=function(){return n.data.filterText.length?n.config.clear:n.config.favorite}:n.getClearButtonClass=function(){return n.data.filterText.length?n.config.clear:"filter-bar-element-hide"};var b=function(){u.classList.contains(n.config.favorite)?n.showModal():o(function(){n.data.filterText="",ionic.requestAnimationFrame(function(){n.showBackdrop(),n.scrollItemsTop(),n.focusInput()})})},g=function(){n.scrollItemsTop(),n.focusInput()},v=function(e){27==e.which?h():n.data.filterText&&n.data.filterText.length&&n.hideBackdropOnTyping?n.hideBackdrop():n.showBackdrop()},k=function(){n.cancelClick!==e.noop?n.cancelClick(n.data.filterItems,n.data.filterText):h()};p.addEventListener("click",k),u.addEventListener("touchstart",b),u.addEventListener("mousedown",b),m.addEventListener("touchstart",g),m.addEventListener("mousedown",g),t.addEventListener("keyup",v);var $=function(){n.filterItems(n.data.filterText)};n.$on("$destroy",function(){i.remove(),t.removeEventListener("keyup",v),l&&r.off(c,"swipe",s),d()}),d=n.$watch("data.filterText",function(e,t){var r;a&&o.cancel(a),e!==t&&(r=e.length&&n.debounce?n.delay:0,a=o($,r,!1))})},template:i}}])}(angular,document),function(e){"use strict";e.module("jett.ionic.filter.bar").provider("$ionicFilterBarConfig",function(){function t(e,t){c.platform[e]=t,i.platform[e]={},o(c,c.platform[e]),r(c.platform[e],i.platform[e],"")}function o(t,r){for(var n in t)n!=a&&t.hasOwnProperty(n)&&(e.isObject(t[n])?(e.isDefined(r[n])||(r[n]={}),o(t[n],r[n])):e.isDefined(r[n])||(r[n]=null))}function r(t,o,i){e.forEach(t,function(l,s){e.isObject(t[s])?(o[s]={},r(t[s],o[s],i+"."+s)):o[s]=function(e){if(arguments.length)return t[s]=e,o;if(t[s]==a){var r=n(c.platform,ionic.Platform.platform()+i+"."+s);return r||r===!1?r:n(c.platform,"default"+i+"."+s)}return t[s]}})}function n(t,o){o=o.split(".");for(var r=0;r<o.length;r++){if(!t||!e.isDefined(t[o[r]]))return null;t=t[o[r]]}return t}var i=this;i.platform={};var a="platform",c={theme:a,clear:a,add:a,close:a,done:a,remove:a,reorder:a,favorite:a,search:a,backdrop:a,transition:a,platform:{},placeholder:a};r(c,i,""),t("default",{clear:"ion-ios-close",add:"ion-ios-plus-outline",close:"ion-ios-close-empty",done:"ion-ios-checkmark-empty",remove:"ion-ios-trash-outline",reorder:"ion-drag",favorite:"ion-ios-star",search:"ion-ios-search-strong",backdrop:!0,transition:"vertical",placeholder:"Search"}),t("ios",{}),t("android",{clear:"ion-android-close",close:"ion-android-close",done:"ion-android-done",remove:"ion-android-delete",favorite:"ion-android-star",search:!1,backdrop:!1,transition:"horizontal"}),i.setPlatformConfig=t,i.$get=function(){return i}})}(angular),function(e,t){"use strict";var o='<ion-modal-view ng-controller="$ionicFilterBarModalCtrl" class="filter-bar-modal"><ion-header-bar class="bar bar-{{::config.theme}} disable-user-behavior"><button class="button button-icon {{::config.close}}" ng-click="closeModal()"></button><h1 class="title" ng-bind-html="::favoritesTitle"></h1><button ng-if="searches.length > 1" class="button button-icon" ng-class="displayData.showReorder ? config.done : config.reorder" ng-click="displayData.showReorder = !displayData.showReorder"></button></ion-header-bar><ion-content><ion-list show-reorder="displayData.showReorder" delegate-handle="searches-list"><ion-item ng-repeat="item in searches" class="item-remove-animate" ng-class="{reordered: item.reordered}" ng-click="itemClicked(item.text, $event)"><span ng-bind-html="item.text"></span><ion-option-button class="button-assertive icon {{::config.remove}}" ng-click="deleteItem(item)"></ion-option-button><ion-reorder-button class="{{::config.reorder}}" on-reorder="moveItem(item, $fromIndex, $toIndex)"></ion-reorder-button></ion-item><div class="item item-input"><input type="text" ng-model="newItem.text" placeholder="{{::favoritesAddPlaceholder}}"/><button class="button button-icon icon {{::config.add}}" ng-click="addItem(newItem)"></button></div></ion-list></ion-content> </ion-modal-view>',r=function(e){var t=["light","stable","positive","calm","balanced","energized","assertive","royal","dark"],o=e&&e.classList;if(o)for(var r=0;r<t.length;r++)if(o.contains("bar-"+t[r]))return t[r]};e.module("jett.ionic.filter.bar").factory("$ionicFilterBar",["$document","$rootScope","$compile","$timeout","$filter","$ionicPlatform","$ionicFilterBarConfig","$ionicConfig","$ionicModal","$ionicScrollDelegate",function(n,i,a,c,l,s,d,f,u,p){function m(n){if(!h){h=!0,n=n||{};var d=i.$new(!0),f=!1,m=!1;n.container&&(n.container=b.querySelector(n.container)),e.extend(d,{config:g,$deregisterBackButton:e.noop,update:e.noop,cancel:e.noop,cancelClick:e.noop,backdropClick:e.noop,hideBackdropOnTyping:!0,done:e.noop,scrollDelegate:p,filter:l("filter"),filterProperties:null,expression:null,comparator:null,debounce:!0,delay:300,cancelText:"Cancel",cancelOnStateChange:!0,container:b,favoritesTitle:"Favorite Searches",favoritesAddPlaceholder:"Add a search term",favoritesEnabled:!1,favoritesKey:"ionic_filter_bar_favorites"},n),d.data={filterText:""},d.config.theme||(d.config.theme=r(d.container.querySelector(".bar.bar-header")));var v=d.element=a('<ion-filter-bar class="filter-bar"></ion-filter-bar>')(d),k=v.children().eq(0),$=k.find("input")[0],B=v.children().eq(1),w=d.scrollDelegate.getScrollView(),y=!!w,x=y?w.__container:null,C=d.cancelOnStateChange?i.$on("$stateChangeSuccess",function(){d.cancelFilterBar()}):e.noop,I=function(){m||(m=!0,$&&$.focus())},T=function(){m&&(m=!1,$&&$.blur())},F=function(){w.__scrollTop>0&&T()};return d.scrollItemsTop=function(){y&&w.__scrollTop>0&&d.scrollDelegate.scrollTop&&d.scrollDelegate.scrollTop()},d.focusInput=function(){m=!1,I()},d.hideBackdrop=function(){B.length&&f&&(f=!1,B.removeClass("active").css("display","none"))},d.showBackdrop=function(){B.length&&!f&&(f=!0,B.css("display","block").addClass("active"))},d.showModal=function(){d.modal=u.fromTemplate(o,{scope:d}),d.modal.show()},d.filterItems=function(t){var o,r;t.length?(d.expression?o=e.bind(this,d.expression,t):e.isArray(d.filterProperties)?(o={},e.forEach(d.filterProperties,function(e){o[e]=t})):d.filterProperties?(o={},o[d.filterProperties]=t):o=t,r=d.filter(d.items,o,d.comparator)):r=d.items,c(function(){d.update(r,t),d.scrollItemsTop()})},d.$deregisterBackButton=s.registerBackButtonAction(function(){c(d.cancelFilterBar)},300),d.removeFilterBar=function(o){d.removed||(d.removed=!0,t.requestAnimationFrame(function(){k.removeClass("filter-bar-in"),T(),d.hideBackdrop(),c(function(){d.scrollItemsTop(),d.update(d.items),d.$destroy(),v.remove(),d.cancelFilterBar.$scope=d.modal=x=w=k=B=$=null,h=!1,(o||e.noop)()},350)}),c(function(){d.container.classList.remove("filter-bar-open")},400),d.$deregisterBackButton(),C(),x&&x.removeEventListener("scroll",F))},d.showFilterBar=function(o){d.removed||(d.container.appendChild(v[0]),d.container.classList.add("filter-bar-open"),d.scrollItemsTop(),t.requestAnimationFrame(function(){d.removed||c(function(){k.addClass("filter-bar-in"),d.focusInput(),d.showBackdrop(),(o||e.noop)()},20,!1)}),x&&x.addEventListener("scroll",F))},d.cancelFilterBar=function(){d.removeFilterBar(d.cancel)},d.showFilterBar(d.done),d.cancelFilterBar.$scope=d,d.cancelFilterBar}}var h=!1,b=n[0].body,g={theme:d.theme(),transition:d.transition(),back:f.backButton.icon(),clear:d.clear(),favorite:d.favorite(),search:d.search(),backdrop:d.backdrop(),placeholder:d.placeholder(),close:d.close(),done:d.done(),reorder:d.reorder(),remove:d.remove(),add:d.add()};return{show:m}}])}(angular,ionic),function(e){"use strict";e.module("jett.ionic.filter.bar").controller("$ionicFilterBarModalCtrl",["$window","$scope","$timeout","$ionicListDelegate",function(t,o,r,n){var i=o.$parent.favoritesKey;o.displayData={showReorder:!1},o.searches=e.fromJson(t.localStorage.getItem(i))||[],o.newItem={text:""},o.moveItem=function(e,t,n){e.reordered=!0,o.searches.splice(t,1),o.searches.splice(n,0,e),r(function(){delete e.reordered},500)},o.deleteItem=function(e){var t=o.searches.indexOf(e);o.searches.splice(t,1)},o.addItem=function(){o.newItem.text&&(o.searches.push({text:o.newItem.text}),o.newItem.text="")},o.closeModal=function(){t.localStorage.setItem(i,e.toJson(o.searches)),o.$parent.modal.remove()},o.itemClicked=function(e,t){var r=!!t.currentTarget.querySelector(".item-options.invisible");r?(o.closeModal(),o.$parent.hideBackdrop(),o.$parent.data.filterText=e,o.$parent.filterItems(e)):n.$getByHandle("searches-list").closeOptionButtons()}}])}(angular);